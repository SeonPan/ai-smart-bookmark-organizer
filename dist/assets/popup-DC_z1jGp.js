import{j as e,c as V,r,u as he,a as Te,b as Ae,P as ge,d as ze,e as Ie,f as Me,g as I,h as Pe,i as _e,k as Le,l as qe,m as Re,n as $e,o as de,p as ue,q as pe,s as me,Z as fe,B as N,F as Z,t as E,v as De,A as Q,w as U,C as W,I as xe,L as z,S as ve,x as He,T as Oe,X as Qe,y as Ue,z as Ve,D as Ze,E as We}from"./useLanguage-C89AZ-qH.js";function A({className:a,...i}){return e.jsx("div",{"data-slot":"skeleton",className:V("bg-accent animate-pulse rounded-md",a),...i})}var $="Switch",[Xe]=Ae($),[Ke,Ge]=Xe($),je=r.forwardRef((a,i)=>{const{__scopeSwitch:o,name:l,checked:t,defaultChecked:c,required:k,disabled:v,value:y="on",onCheckedChange:b,form:u,...p}=a,[j,x]=r.useState(null),S=he(i,m=>x(m)),g=r.useRef(!1),M=j?u||!!j.closest("form"):!0,[C,P]=Te({prop:t,defaultProp:c??!1,onChange:b,caller:$});return e.jsxs(Ke,{scope:o,checked:C,disabled:v,children:[e.jsx(ge.button,{type:"button",role:"switch","aria-checked":C,"aria-required":k,"data-state":we(C),"data-disabled":v?"":void 0,disabled:v,value:y,...p,ref:S,onClick:ze(a.onClick,m=>{P(B=>!B),M&&(g.current=m.isPropagationStopped(),g.current||m.stopPropagation())})}),M&&e.jsx(be,{control:j,bubbles:!g.current,name:l,value:y,checked:C,required:k,disabled:v,form:u,style:{transform:"translateX(-100%)"}})]})});je.displayName=$;var Ne="SwitchThumb",ke=r.forwardRef((a,i)=>{const{__scopeSwitch:o,...l}=a,t=Ge(Ne,o);return e.jsx(ge.span,{"data-state":we(t.checked),"data-disabled":t.disabled?"":void 0,...l,ref:i})});ke.displayName=Ne;var Je="SwitchBubbleInput",be=r.forwardRef(({__scopeSwitch:a,control:i,checked:o,bubbles:l=!0,...t},c)=>{const k=r.useRef(null),v=he(k,c),y=Ie(o),b=Me(i);return r.useEffect(()=>{const u=k.current;if(!u)return;const p=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(p,"checked").set;if(y!==o&&x){const S=new Event("click",{bubbles:l});x.call(u,o),u.dispatchEvent(S)}},[y,o,l]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o,...t,tabIndex:-1,ref:v,style:{...t.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});be.displayName=Je;function we(a){return a?"checked":"unchecked"}var Ye=je,es=ke;function ss({className:a,...i}){return e.jsx(Ye,{"data-slot":"switch",className:V("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...i,children:e.jsx(es,{"data-slot":"switch-thumb",className:V("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const ts=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],X=I("circle-alert",ts);const as=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],rs=I("folder-plus",as);const ns=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],os=I("lightbulb",ns);const cs=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ls=I("pen-line",cs);const is=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ds=I("settings",is),us=()=>e.jsxs("div",{className:"w-[400px] p-4 space-y-4",children:[e.jsx(A,{className:"h-8 w-3/4"}),e.jsx(A,{className:"h-10 w-full"}),e.jsx(A,{className:"h-10 w-full"}),e.jsx(A,{className:"h-20 w-full"}),e.jsx(A,{className:"h-10 w-full"})]}),ps=({suggestion:a,matchedFolder:i,onCreateFolder:o,isCreating:l,t})=>{const c=a.isNewCategory||!i;return e.jsx(Ve,{className:`border-l-4 ${c?"border-l-amber-500 bg-amber-50/50":"border-l-green-500 bg-green-50/50"}`,children:e.jsxs(Ze,{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:`w-4 h-4 ${c?"text-amber-500":"text-green-500"}`}),e.jsx("span",{className:"text-sm font-medium",children:t("popup.aiSuggestion")}),e.jsxs(E,{variant:"secondary",className:"text-xs",children:[Math.round(a.confidence*100),"% ",t("popup.confidence")]})]}),a.reason&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(os,{className:"w-4 h-4 text-muted-foreground mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:a.reason})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:`w-4 h-4 ${c?"text-amber-500":"text-green-500"}`}),e.jsx("span",{className:"text-sm font-medium",children:a.category}),c&&e.jsx(E,{variant:"outline",className:"text-xs text-amber-600 border-amber-300",children:t("popup.newFolder")}),!c&&i&&e.jsx(E,{variant:"outline",className:"text-xs text-green-600 border-green-300",children:t("popup.existingFolder")})]}),c&&e.jsxs(N,{variant:"outline",size:"sm",className:"w-full text-amber-600 border-amber-300 hover:bg-amber-50",onClick:o,disabled:l,children:[l?e.jsx(z,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(rs,{className:"w-4 h-4 mr-2"}),l?t("app.loading"):`${t("popup.createFolder")} "${a.category}"`]})]})})},ms=({status:a,message:i,t:o})=>{const t={idle:{icon:fe,text:o("popup.quickSave"),color:"text-muted-foreground"},analyzing:{icon:z,text:o("popup.analyzing"),color:"text-primary"},saving:{icon:z,text:o("app.loading"),color:"text-primary"},success:{icon:W,text:o("popup.saveSuccess"),color:"text-green-600"},error:{icon:X,text:i||o("popup.saveBookmark"),color:"text-red-500"}}[a],c=t.icon;return e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg bg-muted ${t.color}`,children:[e.jsx(c,{className:`w-4 h-4 ${a==="analyzing"||a==="saving"?"animate-spin":""}`}),e.jsx("span",{className:"text-sm font-medium",children:t.text})]})};function xs(){const{tab:a,loading:i}=Pe(),{settings:o,isValid:l}=_e(),{t}=Le(),[c,k]=r.useState(""),[v,y]=r.useState(""),[b,u]=r.useState(""),[p,j]=r.useState([]),[x,S]=r.useState([]),[g,M]=r.useState(""),[C,P]=r.useState(!1),[m,B]=r.useState(null),[K,_]=r.useState(),[G,J]=r.useState(!1),[D,Y]=r.useState(!1),[H,f]=r.useState(null),[L,ee]=r.useState(""),[ye,se]=r.useState(!1),[te,ae]=r.useState(!1),[re,T]=r.useState("idle"),[q,O]=r.useState(!1),ne=r.useRef(!1);r.useEffect(()=>{a&&(k(a.title||""),Se())},[a]),r.useEffect(()=>{l&&g&&!ne.current&&!q&&(ne.current=!0,chrome.storage.local.get(["quickSaveTriggered"],s=>{s.quickSaveTriggered&&(chrome.storage.local.remove("quickSaveTriggered"),setTimeout(()=>{q||oe()},500))}))},[l,g,q]);const Se=r.useCallback(async()=>{try{const[s,n]=await Promise.all([a?.id?qe(a.id).catch(()=>({description:void 0})):Promise.resolve({description:void 0}),Re()]);y(s.description);const w=$e(n);S(w);const d=h=>{for(const F of h){if(F.title==="ä¹¦ç­¾æ "||F.title==="Bookmarks Bar")return F.id;if(F.children){const ie=d(F.children);if(ie)return ie}}return"1"},R=d(n);M(R),u(R)}catch(s){console.error("åŠ è½½åˆå§‹æ•°æ®å¤±è´¥:",s)}},[a?.id]),oe=async()=>{if(!(!l||!a?.url)){ae(!0),T("analyzing"),f(null);try{const s=x.map(h=>h.title),n=await de(o,c,a.url,v,s,void 0);B(n),j(n.tags);let w=g,d=x.find(h=>h.title.toLowerCase()===n.category.toLowerCase());if(!d&&n.isNewCategory){T("saving");try{const h=await ue(g,n.category);d=h,S(F=>[...F,h])}catch{console.log("åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥ï¼Œä½¿ç”¨ä¹¦ç­¾æ ")}}d&&(w=d.id,_(d),u(d.id)),T("saving");const R=await pe(w,c,a.url);if(n.tags.length>0)try{await me(R.id,n.tags)}catch(h){console.error("ä¿å­˜æ ‡ç­¾å¤±è´¥:",h)}T("success"),Y(!0),setTimeout(()=>{window.close()},2e3)}catch(s){console.error("å¿«é€Ÿä¿å­˜å¤±è´¥:",s),T("error"),f(s instanceof Error?s.message:"ä¿å­˜å¤±è´¥"),O(!0)}}},Ce=async()=>{if(!l){f("è¯·å…ˆé…ç½® AI è®¾ç½®ï¼ˆäº‘ç«¯ API æˆ–æœ¬åœ° Ollamaï¼‰");return}P(!0),f(null),B(null),_(void 0);try{const s=x.map(d=>d.title),n=await de(o,c,a?.url||"",v,s,void 0);B(n),j(n.tags);const w=x.find(d=>d.title.toLowerCase()===n.category.toLowerCase());_(w),w&&n.useExistingFolder&&u(w.id)}catch(s){f(s instanceof Error?s.message:"AI åˆ†æžå¤±è´¥")}finally{P(!1)}},Fe=async()=>{if(m?.category){se(!0),f(null);try{const s=await ue(g,m.category);S(n=>[...n,s]),u(s.id),_(s),B(n=>n?{...n,isNewCategory:!1,useExistingFolder:!0}:null)}catch(s){f(s instanceof Error?s.message:"åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥")}finally{se(!1)}}},Be=async()=>{if(!b){f("è¯·é€‰æ‹©ä¿å­˜ä½ç½®");return}J(!0),f(null);try{const s=await pe(b,c,a?.url||"");if(p.length>0)try{await me(s.id,p)}catch(n){console.error("ä¿å­˜æ ‡ç­¾å¤±è´¥:",n)}Y(!0),setTimeout(()=>{window.close()},1500)}catch(s){f(s instanceof Error?s.message:"ä¿å­˜å¤±è´¥")}finally{J(!1)}},ce=()=>{L&&!p.includes(L)&&(j([...p,L]),ee(""))},Ee=s=>{j(p.filter(n=>n!==s))},le=()=>{chrome.runtime.openOptionsPage()};return i?e.jsx(us,{}):te&&!q?e.jsxs("div",{className:"w-[400px] bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-primary"}),e.jsx("h1",{className:"text-lg font-semibold",children:t("popup.quickSave")})]}),e.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>O(!0),children:[e.jsx(ls,{className:"w-4 h-4 mr-1"}),t("popup.edit")]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:c}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:a?.url})]}),e.jsx(ms,{status:re,message:H||void 0,t}),m&&e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:m.category}),K&&e.jsx(E,{variant:"outline",className:"text-xs",children:"çŽ°æœ‰"})]}),p.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:p.map(s=>e.jsx(E,{variant:"secondary",className:"text-xs",children:s},s))})]}),re!=="success"&&e.jsx(N,{variant:"outline",className:"w-full",onClick:()=>O(!0),children:t("popup.switchToFullEdit")})]})]}):e.jsxs("div",{className:"w-[400px] min-h-[400px] bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-primary"}),e.jsx("h1",{className:"text-lg font-semibold",children:t("popup.smartSave")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mr-2",children:[e.jsx(ss,{checked:te,onCheckedChange:s=>{ae(s),s&&oe()},id:"quick-mode"}),e.jsx("label",{htmlFor:"quick-mode",className:"text-xs text-muted-foreground cursor-pointer",children:t("popup.quickMode")})]}),e.jsx(N,{variant:"ghost",size:"icon",onClick:le,children:e.jsx(ds,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[!l&&e.jsxs(Q,{variant:"destructive",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsxs(U,{className:"text-xs",children:[t("popup.pleaseConfigAI"),e.jsx(N,{variant:"link",size:"sm",className:"h-auto p-0 ml-2",onClick:le,children:t("ai.goSettings")})]})]}),H&&e.jsxs(Q,{variant:"destructive",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx(U,{className:"text-xs",children:H})]}),D&&e.jsxs(Q,{className:"bg-green-50 border-green-200",children:[e.jsx(W,{className:"w-4 h-4 text-green-600"}),e.jsx(U,{className:"text-xs text-green-700",children:t("popup.saveSuccess")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:t("popup.title")}),e.jsx(xe,{value:c,onChange:s=>k(s.target.value),placeholder:t("popup.title")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:t("popup.url")}),e.jsx("div",{className:"text-xs text-muted-foreground truncate bg-muted p-2 rounded",children:a?.url})]}),e.jsx(N,{variant:"outline",className:"w-full",onClick:Ce,disabled:C||!l,children:C?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mr-2 animate-spin"}),t("popup.analyzing")]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),t(m?"popup.reanalyze":"popup.aiAnalyze")]})}),m&&e.jsx(ps,{suggestion:m,matchedFolder:K,onCreateFolder:Fe,isCreating:ye,t}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),t("popup.saveTo")]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:b,onChange:s=>u(s.target.value),className:"w-full h-10 px-3 pr-10 rounded-md border border-input bg-background text-sm appearance-none cursor-pointer",children:[e.jsx("option",{value:"",children:t("popup.selectFolder")}),e.jsx("optgroup",{label:t("popup.bookmarkBar"),children:e.jsxs("option",{value:g,children:["ðŸ“‘ ",t("popup.bookmarkBar")]})}),x.length>0&&e.jsx("optgroup",{label:t("popup.myFolders"),children:x.map(s=>e.jsxs("option",{value:s.id,children:["ðŸ“ ",s.title]},s.id))})]}),e.jsx(He,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),t("popup.tags")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(xe,{value:L,onChange:s=>ee(s.target.value),placeholder:t("popup.addTag"),className:"flex-1",onKeyDown:s=>s.key==="Enter"&&ce()}),e.jsx(N,{variant:"outline",size:"sm",onClick:ce,children:t("popup.add")})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(s=>e.jsxs(E,{variant:"secondary",className:"gap-1",children:[s,e.jsx("button",{onClick:()=>Ee(s),className:"hover:text-destructive",children:e.jsx(Qe,{className:"w-3 h-3"})})]},s))})]}),e.jsx(Ue,{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"outline",className:"flex-1",onClick:()=>window.close(),children:t("btn.cancel")}),e.jsx(N,{className:"flex-1",onClick:Be,disabled:G||D||!b,children:G?e.jsx(z,{className:"w-4 h-4 animate-spin"}):D?e.jsx(W,{className:"w-4 h-4"}):t("popup.saveBookmark")})]})]})]})}We.createRoot(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(xs,{})}));
